\documentclass[12pt,letterpaper]{article}
\usepackage{natbib}

%Packages
\usepackage{pdflscape}
\usepackage{fixltx2e}
\usepackage{textcomp}
\usepackage{fullpage}
\usepackage{float}
\usepackage{latexsym}
\usepackage{url}
\usepackage{epsfig}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{bm}
\usepackage{array}
\usepackage[version=3]{mhchem}
\usepackage{ifthen}
\usepackage{caption}
\usepackage{hyperref}
\usepackage{amsthm}
\usepackage{amstext}
\usepackage{enumerate}
\usepackage[osf]{mathpazo}
\usepackage{dcolumn}
\usepackage{lineno}
\usepackage{dcolumn}
\usepackage{mathtools}
\usepackage{pdflscape}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}%
\DeclarePairedDelimiter\norm{\lVert}{\rVert}%
\newcolumntype{d}[1]{D{.}{.}{#1}}

\pagenumbering{arabic}


%Pagination style and stuff
\linespread{2}
\raggedright
\setlength{\parindent}{0.5in}
\setcounter{secnumdepth}{0} 
\renewcommand{\section}[1]{%
\bigskip
\begin{center}
\begin{Large}
\normalfont\scshape #1
\medskip
\end{Large}
\end{center}}
\renewcommand{\subsection}[1]{%
\bigskip
\begin{center}
\begin{large}
\normalfont\itshape #1
\end{large}
\end{center}}
\renewcommand{\subsubsection}[1]{%
\vspace{2ex}
\noindent
\textit{#1.}---}
\renewcommand{\tableofcontents}{}
%\bibpunct{(}{)}{;}{a}{}{,}

%---------------------------------------------
%
%       START
%
%---------------------------------------------

\begin{document}

%Running head
\begin{flushright}
Version dated: \today
\end{flushright}
\bigskip
\noindent RH: Characters correlation

\bigskip
\medskip
\begin{center}

\noindent{\Large \bf Effect of violating character independence on tree topology}
\bigskip

\noindent {\normalsize \sc Thomas Guillerme$^1$$^*$, and Martin D. Brazeau$^1$}\\
\noindent {\small \it 
$^1$Imperial College London, Silwood Park Campus, Department of Life Sciences, Buckhurst Road, Ascot SL5 7PY, United Kingdom.\\}
\end{center}
\medskip
\noindent{*\bf Corresponding author.} \textit{guillert@tcd.ie}\\ 
\vspace{1in}

%Line numbering
\modulolinenumbers[1]
\linenumbers

%---------------------------------------------
%
%       ABSTRACT
%
%---------------------------------------------

% SystBiol
% Palaeobiology
% JEB
% Biological Journal of the Linnean Society
% Royal Society Open Science - but rewriting needed (more story style)
% Palaeontology


\newpage
\begin{abstract}
blablabla
\end{abstract}

The project implies inferring a total of 2880 phylogenetic trees (40 replicates of 9 data combination scenarios generating 4 trees each; both inferred in Bayesian and under Maximum Parsimony).
The calculations for the project is ongoing since December 2016 a and is now 95.27\% completed (with a current cumulated computational time of around 80 CPU years that generated 3.2 TB of trees).
The pipelines for analysing the data and producing the publishable figures and tables is already implemented and most of the manuscript is already written ()

Overall we found a positive effect of reducing character correlations on recovering the correct topology.
However, this effect is less important for matrices with a small number of taxa (~25) were reducing character correlation was not more effective than randomly drawing characters.
Furthermore, in bigger matrices (~350 taxa), there is a strong effect of the inference method with Bayesian trees being consistently less affected by character correlation than maximum parsimony trees.

These results suggest that ignoring the problem of character correlation or independence can easily impact topology in phylogenetic analysis.
However, encouragingly, they also suggest that, unless correlation is effectively maximised or minimised, probabilistic methods can easily accommodate for random correlation between characters.


\noindent (Keywords: )\\

\vspace{1.5in}

\newpage 

%---------------------------------------------
%
%       INTRODUCTION
%
%---------------------------------------------
\section{Introduction}

The last six years have seen a fantastic expansion of the use of discrete morphological data in macroevolutionary studies.
Traditionally confined to ``classic'' cladistic studies, these methods have recently been widely expanded and improved whether based on the models and methods for inferring phylogenies \citep[e.g.][]{heath2014fossilized,Wright01072016} or to combine them with molecular data \citep[e.g.][]{pyrondivergence2011,ronquista2012}.
In parallel, much development has also been done on pre-phylogenetic analysis \citep[e.g. data collection;][]{morphobank} as well as on post-phylogenetic ones \citep[e.g. morphological disparity analysis;][]{Close2015,Claddis}.
Nonetheless, using discrete morphological data in macroevolutionary studies comes with several caveats based to the nature of data used \citep{Guillerme2016146,bapst2017combined}; the coding of this data \citep{Brazeau2011,simoes2017giant}; the inference method \citep{spencerefficacy2013,wrightbayesian2014,OReilly20160081,puttick2017uncertain,goloboff2017weighted} or the dating methods \citep{Arcila2015131,o2016tips}.

One aspect of the data, however, is often neglected: the correlation between morphological characters.
In fact, the assumption of character independence is at the base of phylogenetic inference and as been mentioned or implied throughout the history of phylogenetic methods \citep[e.g.][]{joysey1982problems,felsenstein1985phylogenies,lewisa2001,felsenstein2004inferring}.
Nowadays, this assumption of character independence is nearly always accepted as a fact and rarely tested or questioned in empirical datasets.
However - especially for discrete morphological data - this assumption of independence is probably violated more often than not due to the sheer nature of phylogenetic data.
In practice, dependence between characters can be induced in at least three different ways:

\begin{itemize}

    %TG: Change this induced thing

    \item \textbf{Biological induce dependence between characters:} this is the result of a link between two characters through development and/or biological function.
    These links are readily understood through developmental biology or understanding of shared function between features \citep{goswami2006morphological,goswami2010,goswami2014macroevolutionary}.
    One trivial example would be the link between lower and upper molar characters in mammals: one character describing a feature of a lower molar will be expected to be correlated to another character describing another feature of the associated upper molar.

    \item \textbf{Evolutionary induced dependence between characters:} this is the result of sets of characters co-evolving along branches in the phylogeny.
    The character's correlation is thus due to shared evolutionary history of these characters.
    Many methods have been developed to study these correlations, especially since they can provide us with a lot of information on how specific groups acquired specific characteristics \citep{Lande1983,Maddison1990,Pagel1994,Pagel2006,Grabowski2016}.
    For example, the apparition of the jaw as a character in gnatosthomes correlates with a whole sweep of characters present in modern gnatosthomes (e.g. beaks, tribosphenic molars, jaw protrusion, etc.). %TG: this links to inapplicable data!


    %TG: This one can be reworded. Get a dichotomie a priori/a posteriori correlation. + add trade off in coding (more characters = more info but less independence)
    \item \textbf{Coding induced dependence between characters:} this is the results of researchers methodology for defining or/and coding discrete morphological characters \citep{Brazeau2011,simoes2017giant}.
    These links can be due to methodological errors: for example one could define a character describing a particular feature on a left molar as well as another character describing the same feature on a right molar.
    It is worth noting, however, that these dependences could also be due to the nature of the available data, especially in palaeontology.
    For example, when only one fragmentary molar is available to describe a specimen, researchers have to ``extract'' as much phylogenetic information from the available data as possible, potentially inducing correlations.
\end{itemize}

\noindent Of course, the three sources of dependences can also be correlated to each other: characters describing the left and right lower/upper molars will have induced dependence due to the modularity of the molars, their shared history and the duplicated coding!

As mentioned above, these sources of dependence between characters are well studied in biology.
Biological and evolutionary dependences are inherent parts to evo-devo and maroevolution and best practices to avoid coding induced dependences are commonly known and applied.
However, eventually, all these characters, whether they are independent or not are analysed through phylogenetic inferences softwares that are blind to these distinctions.
This introduces a new, less studied, source of character dependence:

\noindent \textbf{Software induced correlation between characters:} this is the result how software actually interprets the differences between characters.
I.e. the vast majority of phylogenetic software ignores both the character's definition and the different states signification (simply treating them as different/similar tokens) leading to dependence between characters.
For example, consider the following matrix containing four cetartiodactyles - say a pig (e.g. \textit{Sus}), a deer (\textit{Cervus}), a hippo (\textit{Hippopotamus}) and a whale (\textit{Balaenoptera}) - and four characters - say (\textbf{C1}: presence (1) or absence (0) of an astragal; \textbf{C2}: presence (0) or absence (1) of baleens; \textbf{C3}: presence (0) or absence (1) of a left astragal with a double pulley; \textbf{C4}: presence (0) or absence (1) of a right astragal with a double pulley:

\begin{table}
\center
    \begin{tabular}{r|cccc}
            & C1 & C2 & C3 & C4\\
        \hline
        \textit{Sus} & 1 & 1 & 1 & 1\\
        \textit{Cervus} & 1 & 1 & 1 & 1\\
        \textit{Hippopotamus} & 1 & 1 & 1 & 1\\
        \textit{Balaenoptera} & 0 & 0 & 0 & 0\\
    \end{tabular}
    \caption{Example of a matrix with software induced character correlation. \textbf{C1}: presence (1) or absence (0) of an astragal; \textbf{C2}: presence (0) or absence (1) of baleens; \textbf{C3}: presence (0) or absence (1) of a left astragal with a double pulley; \textbf{C4}: presence (0) or absence (1) of a right astragal with a double pulley.}
    \label{Tab:example_matrix}
\end{table}

In the example in Table \ref{Tab:example_matrix}, the characters \textbf{C1} and \textbf{C2} are the most likely to be truly independent; characters \textbf{C3} and \textbf{C4} suffer from a a coding induced dependency; characters \textbf{C1} and \textbf{C3}/\textbf{C4} have an evolutionary induce dependency and again, characters \textbf{C2} and \textbf{C3}/\textbf{C4} are likely to be independent.
Yet a phylogenetic software will treat all these four characters in exactly the same way: only the sheer difference between the different character states tokens will be used in order to infer a phylogenetic tree.
It is thus still unclear what will be the effect of characters correlation on phylogenetic inference: how does these correlation really affect topology?

If the three induced sources of correlation are fairly well studied, their actual interpretation in phylogenetic inference, has, to our knowledge, never been studied through a simulation protocol.
In this study, we formally assess the effect of discrete character's correlation using simulated and empirical data.
We propose a new metric to measure the difference between characters (as a proxy for these three sources of correlation) and a protocol to modify discrete morphological matrices to increase/decrease the overall differences/similarities between characters.
We found that @@@


% However, only several attempts have been made on the actual effect of characters correlation on phylogenetic inference with two notable exceptions of \cite{Davalos01072014} on empirical data and \cite{ZouConvergence} on molecular data. %TG: put that somwhere


\section{Methods}

We applied the following simulation protocol to assess the effect of characters correlation (Fig.\ref{Fig:outline}):
\begin{enumerate}
    \item \textbf{Simulating matrices}: we simulated discrete morphological matrices with 25, 75 and 150 taxa for 100, 350 and 1000 characters, hereafter called the ``normal'' matrices.
    \item \textbf{Modifying matrices}: we modified the ``normal'' matrices by duplicating characters in order to maximise or minimise characters differences (hereafter called respectively ``maximised'' and ``minimised'' matrices) by removing respectively the least or most different characters and replacing them randomly by the remaining characters.
    We also randomly duplicated characters from the ``normal'' matrices without biasing towards maximising or minimising character difference to create randomised matrices (hereafter called the ``randomised'' matrices - equivalent to a null expectancy).
    \item \textbf{Inferring topologies}: we inferred the topologies from the ``normal'', ``maximised'', ``minimised'' and ``randomised'' matrices using both Maximum Parsimony and Bayesian inference (hereafter called the ``normal'', ``maximised'', ``minimised'' and ``randomised'' trees).
    \item \textbf{Comparing topologies}: finally, we compared the ``normal'' to the ``maximised'', ``minimised'' and ``randomised'' trees to measure the effect of character correlation on topology.
\end{enumerate}
Each steps are described below in more details, as well as our proposed definition of the Character Difference metric.

\begin{figure}[!htbp]
\centering
   \includegraphics[width=0.9\textwidth]{Figures/outline.pdf}
\caption{Outline of the simulation protocol: the first step includes both the simulation and the modification of the matrices (thin solid lines); the second step includes tree inference using Maximum Parsimony and Bayesian inference (thick solid lines); the third step includes comparing the resulting tree topologies (dashed lines).}
\label{Fig:outline}
\end{figure}

\subsection{Measuring differences between characters}
\label{CD_description}
We define characters as being correlated if they give the same phylogenetic information.
In order to measure this similitude in phylogenetic information, we propose a new distance metric to measure the difference between two characters:

\subsubsection{Characters Difference ($CD$)}
\begin{equation}
    CD_{(x,y)} = 1 - \left(\frac{\abs*{\frac{\sum_{i}^{n}\abs{x_{i} - y_{i}}}{n}-\frac{1}{2}}}{\frac{1}{2}}\right)
\end{equation}

\noindent Where $n$ is the number of taxa with comparable data and $x_i$ and $y_i$ are each characters states for the characters $x$ and $y$ and the taxa $i$.
$CD$ is a continuous distance metric valid in a mathematical sense (see Supplementary Material 1).
Since we are considering differences as being only Fitch-like (i.e. non-weighted and non-ordinate), we calculated the difference between character states in a qualitative way.
Two same character states tokens have a difference of $0$ and two different ones have a difference of $1$ (e.g. $0 - 0 = 0$ or $1 - 8 = 1$).
Additionally, we only consider differences for taxa with shared information \citep[i.e. a Gower distance;][]{GowerDist}.
We standardised each characters by arbitrarily modifying their character states tokens by order of appearance.
In other words, we replaced all the occurrences of the first token to be $1$, the second to be $2$, etc.
This way, a character \texttt{A = \{2,2,3,0,0,3\}} would be standardised as \texttt{A' = \{1,1,2,3,3,2\}} \citep[following the \textit{xyz} notation in][p.13]{felsenstein2004inferring}.
Note that in terms of phylogenetic signal, both \texttt{A} and \texttt{A'} are exactly identical (forming three distinct groups).

When the character difference is equal to $0$, it means that characters convey the same phylogenetic signal.
When the character difference is equal to $1$ it means it conveys the most different signal.
For example with three characters \texttt{A = \{0,1,1,1\}}, \texttt{B = \{1,0,0,0\}} and \texttt{C = \{0,1,2,3\}}, $CD_{(A,B)} = 0$ and $CD_{(A,C)} = 1$.

\subsection{Simulating discrete morphological matrices}
To simulate the matrices we applied a protocol very similar to \citep{Guillerme2016146}.
First, we generate random birth-death trees with the birth ($\lambda$) and death ($\mu$) parameters sampled from a uniform ($0$,$1$) distribution maintaining $\lambda$ $>$ $\mu$ using the diversitree \texttt{R} package \citep[v0.9-8;][]{fitzjohndiversitree2012} and saving the tree after reaching either 25, 75 or 150 taxa.
For each tree, we arbitrarily set the outgroup to be the first taxa (alphabetically) thus effectively rooting the trees on this taxa.
These trees are hereafter called the ``true'' trees.
We then simulated discrete morphological characters on the topology of these trees using the either of the two following models:
\begin{itemize}
    \item The morphological HKY-binary model \citep{OReilly20160081} which is an HKY model \citep{HKY85} with a random states frequency (sampled from a uniform distribution $(0,1)$ and scaled to sum to $1$) and using a transition/transvertion rate of $2$ \citep{douadycomparison2003} but where the purines (A,G) were changed into state $0$ and the pyrimidines (C,T) in state $1$.
    This model has the advantage of not favouring Bayesian inference \citep[since it doesn't use a M$k$ model;][; see below]{OReilly20160081} but the downside of it is it can only generate binary state characters \citep[or 4 states;][]{puttick2017uncertain}.
    \item To generate more than binary states characters, we used the M$k$ model \citep{lewisa2001}.
    We draw the number of character states with a probability of $0.85$ for binary characters and $0.15$ for three state characters \citep{Guillerme2016146}.
    This model assumes a equal transition rate between character states that might seem overly simplifying and excludes other observed transition patterns \citep[e.g. Dollo characters;][]{Dollo,wright2015came}.
    Recently however, \cite{Wright01072016} have shown that an equal rate transition is still the most present in empirical data.
\end{itemize}

\noindent For each character, both models (morphological HKY-binary or M$k$) where chosen randomly and ran with an overall evolutionary rate drawn from a gamma distribution ($\beta$ = $100$ and $\alpha$ = $5$).
This low evolutionary rate values allowed to reduce the number of homoplasic character changes and thus reinforce the phylogenetic information in the matrices.
We re-simulated every invariant characters to obtain a matrix with no invariant characters.
To ensure that our simulation where reflecting realistic observed parameters, we only selected matrices with Consistency Indices (CI) superior to $0.26$ \citep{OReilly20160081}.

For each trees with 25, 75 or 150 taxa we generated matrices with 100, 350 and 1000 characters following \cite{OReilly20160081}.
The matrices where generated using the \texttt{dispRity R} package \citep{thomas_guillerme_2016_55646}.
To estimate the variance of our simulations and assess the effect of our random parameters, we repeated this step 40 times resulting in 360 ``normal'' morphological matrices.

\subsection{Modifying the matrices}
We calculated the pairwise Character Differences for each generated matrices using the \texttt{dispRity R} package \citep{thomas_guillerme_2016_55646}. %TG: TO IMPLEMENT! 
We then modified the matrices to either maximise or minimise the pairwise character differences for each matrices using three different algorithms.
For maximising the pairwise differences between characters, we selected the characters that where the most similar to all the others (i.e. with an average character difference $<$$0.25$) and replaced them randomly by any of the remaining characters.
This operation increased the overall pairwise character difference in the matrix thus making the characters more dissimilar.
Conversely, for minimising the pairwise character differences, we selected the most dissimilar characters (i.e. with an average character difference $<$$0.75$) and randomly replaced them with the remaining ones.
Finally, because this operation effectively changes the weight of characters (i.e. giving the characters $<$$0.25$ or $>$$0.75$ a weight of $0$ and giving the randomly selected remaining characters a weight of +$1$), we randomly replaced the average number of characters replaced in the character maximisation and minimisation by any other characters as a randomised expectation modification (i.e. randomly weighting characters).
This step resulted in a total of 1440 matrices (hereafter called the ``normal'', ``maximised'', ``minimised'' and ``randomised'' matrices - see Fig. \ref{Fig:modif_matrix} for an illustration).
The algorithms for the three modifications are available on GitHub@@@. %(Modifying_matrices.html) %TG: "@@@" is my "to replace" sign.

\begin{figure}[!htbp]
\centering
   \includegraphics[width=1\textwidth]{Figures/Modif_matrix.pdf}
\caption{Example illustration of the protocol for modifying matrices. The matrices represent the pairwise character differences for 100 characters. Blue colours correspond to low character differences and orange colours correspond to high character differences. \textbf{A} - a random Birth-Death tree is simulated and used for generating the normal matrix (\textbf{B}), characters in this matrix are then removed or duplicated to favour maximised character difference (\textbf{C}), minimised it (\textbf{D}) or randomise it (\textbf{E}).}
\label{Fig:modif_matrix}
\end{figure}

\subsection{Inferring topologies}
We inferred the topologies in both Bayesian and Maximum Parsimony using MrBayes \citep[v3.2.6;][]{Ronquist2012mrbayes} and PAUP* \citep[v4.0a151;][]{swofford2001paup} respectively.
For both methods, we used the arbitrarily chosen outgroup in the simulations to root our trees.
The Maximum Parsimony inference was run using a heuristic search with random sequence addition replicate 100 times with a limit of $5\times10^6$ rearrangements per replicates (\texttt{hsearch addseq=random nreps=100 rearrlimit=5000000 limitperrep=yes}).

The Bayesian inference was run using an M\textit{k} model with ascertainment bias and four discrete gamma rate categories (M\textit{kv} $4\Gamma$ - \texttt{lset nst=1 rates=gamma Ngammacat=4}) with an variable rate prior an exponential (0.5) shape (\texttt{prset ratepr=variable Shapepr=Exponential(0.5)}).
We ran two runs of 6 chains each (2 hot, 4 cold) for a maximum of $1\times10^9$ generations with a sampling every 200 generations.
We automatically stopped the MCMC when the average standard deviation of split frequencies (ASDSF) between both runs fell below 0.01 (with a diagnosis every $1\times10^4$ generations - \texttt{mcmc nruns=2 Nchains=6 ngen=1000000000 samplefreq=200 printfreq=2000 diagnfreq=10000 Stoprule=YES stopval=0.01 mcmcdiagn=YES}).
Due to cluster hardware requirements an to save some time, when chains didn't converged and the runs exceeded 5GB each, we aborted the MCMC and computed the consensus tree from the unconverged chains.
In practice, these few MCMC got stuck at an ASDSF around (but not below) 0.01.

A strict majority rule tree was then calculated for both Bayesian an Maximum Parsimony trees.
For the Bayesian consensus trees, the 25\% first trees of the posterior tree distribution were excluded as a burnin.
The 2880 tree inferences took around 1 CPU century on the Imperial College High Performance Computing Service \citep[2-3GHz clock rate;][]{HPC}.

\subsection{Comparing topologies}
We compared the topologies using the same approach as in \cite{Guillerme2016146}: we measured both the Robinson-Fould distance \citep{RF1981} and the Triplets distance \citep{dobson1975triplets} between the trees inferred from the ``maximised'', ``minimised'' and ``randomised'' matrices and the tree inferred from the ``normal'' matrix.
We explored the effect of Character Difference on recovering the ``normal'' topology by comparing the ``maximised'', ``minimised'' and ``randomised'' trees to the ``normal'' tree (Figs \ref{Fig:RF_results_best} and \ref{Fig:Tr_results_best} and Tables @@@).

The metrics scores where obtained using the TreeCmp java script \citep{Bogdanowicz2012}.
The measurements where then standardised using the Normalised Tree Similarity metric \citep[$NTS$; i.e. centering the metrics scores using the mean metric score for 1000 pairwise comparisons between random trees with $n$ taxa;][]{Bogdanowicz2012,Guillerme2016146}.
When the normalised metric has a score of $1$ it means both trees are identical, when it has a score of $0$ it means the trees are no more different than expected by chance and when it has a score $<0$ the trees are more different than expected by chance.
The normalised score for both metrics thus reflects two distinct aspects of tree topology: (1) the Normalised Robinson-Fould ($NTS_{RF}$) Similarity reflects the conservation of clades (i.e. a score close to $1$ indicates that most clades are identical in both trees); and (2) the Normalised Triplets Similarity ($NTS_{Tr}$) reflects the position of taxa (i.e. a score close to $1$ indicates that most taxa have the same neighbours in both trees).

Because both $NTS_{RF}$ and $NTS_{Tr}$ metrics are bounded at 1, the resulting residuals distribution of $NTS$ scores was not normal thus preventing the use of parametric nested anova for comparisons (see Supplementary @@@).
Instead, we used the a simple non-parametric metric for measuring the probability of overlap between two distributions, the Bhattacharyya Coefficient \citep[$BC$;][]{Bhattacharyya,Guillerme2016146,soto2016trace}.
We considered distribution to be significantly similar if they had an overlap probability $>0.95$ and different if they had an overlap probability $>0.05$.
Comparisons falling within these range can not be designated as strictly similar/different but can still be ranked (e.g. for three distributions A, B, C, if $BC_{(A,B)} = 0.15$ and $BC_{(A,C)} = 0.65$, we cannot consider either distribution significantly different or similar but $B$ still has a lower probability of being similar to $A$ than $C$).


\section{Results}

@@@ NOTE: THESE RESULTS ARE NOT FINAL - I thus didn't spend too much time describing them @@@

\subsection{Effect of Character Differences on topology}
The overall amount of pairwise $CD$ in a matrix has an effect of the ability to recover the correct topology.
An overall decrease in $CD$ leads to an decrease in $NTS_{RF}$ (as a proxy for clade conservation - Fig. \ref{Fig:RF_results_best}) and in $NTS_{Tr}$ (as a proxy for taxa position - Fig. \ref{Fig:Tr_results_best}).
Conversely, an increase in $CD$ leads to an increase in in $NTS_{RF}$ (Fig. \ref{Fig:RF_results_best}) and $NTS_{Tr}$ (Fig. \ref{Fig:Tr_results_best}).
This beneficial effect can be contrasted however with a similar beneficial effect when simply randomising the character differences (Figs \ref{Fig:RF_results_best} and \ref{Fig:Tr_results_best}).

\subsubsection{Effect of the number of characters}
This negative effect of decreased $CD$ (and positive of increased $CD$) on topology is increased with the number of characters.
% Test pulled difference between character numbers.

\subsubsection{Effect of the number of taxa}
Conversely, the effect of variation in $CD$ doesn't seem to drastically increase with the number of taxa after 75 taxa in our simulations.
% Test pulled difference between number of taxa.

\subsection{Effect of Character Differences on the inference method}
There seems to be a strong effect on the ability to recover the correct topology depending on the tree inference method.
Parsimony trees seems to be more sensible than Bayesian ones.
% Test pulled difference between methods.


\begin{figure}[!htbp]
\centering
   \includegraphics[width=1\textwidth]{Figures/RF_results_best.pdf} %TG: These figures will be cleaned up once I have the final results.
\caption{\small{Effect of Character Difference on recovering the ``best'' topology. The y axis represents the Normalised Tree Similarity using Robinson-Fould distance for matrices with 25, 75 and 150 taxa from top to bottom respectively. The x axis represents the different Character Difference scenarios and tree inference method with the Maximised Character Difference in Bayesian (red) and under Maximum Parsimony (orange), the Minimised Character Difference in Bayesian (dark green) and under Maximum Parsimony (light green) and the Randomised Character Difference in Bayesian (dark blue) and under Maximum Parsimony (light blue) for matrices of 100, 350 and 1000 characters in the panels from left to right.}}
\label{Fig:RF_results_best}
\end{figure}


\begin{figure}[!htbp]
\centering
   \includegraphics[width=1\textwidth]{Figures/Tr_results_best.pdf} %TG: These figures will be cleaned up once I have the final results.
\caption{Effect of Character Difference on recovering the ``best'' topology. The axis are identical to figure \ref{Fig:RF_results_best} but y axis represents the Normalised Tree Similarity using Triplets distance.}
\label{Fig:Tr_results_best}
\end{figure}


% latex table generated in R 3.4.0 by xtable 1.8-2 package
% Fri Jul 28 10:29:26 2017
\begin{table}[ht]
\centering
\begin{tabular}{rlllrrrrrrrrr}
  \hline
Taxa & Char. & Method & \multicolumn{3}{c}{max \textit{vs}. min} & \multicolumn{3}{c}{max \textit{vs}. rand} & \multicolumn{3}{c}{min \textit{vs}. rand} \\
 & & & BC & W & p & BC & W & p & BC & W & p \\ 
  \hline
25 & 100 & Bay. & 0.67 & 1130.00 & \textbf{0.00} & 0.85 & 856.00 & \textbf{1.00} & 0.74 & 320.00 & \textbf{0.00} \\ 
   & 350 &   & 0.71 & 1236.50 & \textbf{0.00} & \textbf{0.96} & 844.00 & \textbf{1.00} & 0.73 & 338.00 & \textbf{0.00} \\ 
   & 1000 &   & 0.71 & 1321.50 & \textbf{0.00} & 0.89 & 802.00 & 1.00 & 0.67 & 226.00 & \textbf{0.00} \\ 
75 & 100 &   & 0.48 & 1366.50 & \textbf{0.00} & 0.66 & 1134.00 & \textbf{0.01} & 0.69 & 264.00 & \textbf{0.00} \\ 
   & 350 &   & 0.40 & 999.50 & \textbf{0.00} & 0.59 & 878.50 & \textbf{0.00} & 0.71 & 188.00 & \textbf{0.00} \\ 
   & 1000 &   & 0.53 & 390.00 & \textbf{0.00} & 0.80 & 341.50 & 0.13 & 0.69 & 100.00 & 0.14 \\ 
150 & 100 &   & \textbf{0.00} & 256.00 & \textbf{0.00} & \textbf{0.00} & 256.00 & \textbf{0.00} & 0.42 & 24.00 & \textbf{0.01} \\ 
    & 350 &   & 0.07 & 361.00 & \textbf{0.00} & \textbf{0.05} & 361.00 & \textbf{0.00} & 0.39 & 56.50 & \textbf{0.02} \\ 
    & 1000 &   & \textbf{0.00} & 121.00 & \textbf{0.00} & 0.13 & 119.00 & \textbf{0.01} & \textbf{0.00} & 0.00 & \textbf{0.00} \\ 
25 & 100 & Par. & 0.63 & 357.00 & \textbf{0.00} & 0.91 & 234.00 & 1.00 & 0.71 & 85.00 & 0.10 \\ 
   & 350 &   & 0.34 & 387.00 & \textbf{0.00} & 0.79 & 287.50 & 0.94 & 0.49 & 61.50 & \textbf{0.01} \\ 
   & 1000 &  & 0.43 & 384.00 & \textbf{0.00} & 0.79 & 289.50 & 0.62 & 0.71 & 65.00 & \textbf{0.01} \\ 
75 & 100 &   & 0.38 & 379.50 & \textbf{0.00} & 0.40 & 359.00 & \textbf{0.00} & 0.75 & 157.50 & 1.00 \\ 
   & 350 &   & 0.25 & 393.00 & \textbf{0.00} & 0.76 & 311.00 & 0.13 & 0.65 & 55.50 & \textbf{0.01} \\ 
   & 1000 &   & 0.15 & 393.00 & \textbf{0.00} & 0.46 & 362.00 & \textbf{0.00} & 0.46 & 58.00 & \textbf{0.01} \\ 
150 & 100 &   & 0.34 & 357.50 & \textbf{0.00} & 0.49 & 356.50 & \textbf{0.00} & 0.73 & 197.00 & 1.00 \\ 
    & 350 &   & 0.17 & 390.00 & \textbf{0.00} & 0.60 & 348.00 & \textbf{0.00} & 0.63 & 63.50 & \textbf{0.01} \\ 
    & 1000 &   & \textbf{0.00} & 400.00 & \textbf{0.00} & 0.71 & 328.50 &\textbf{0.03} & 0.34 & 24.00 & \textbf{0.00} \\ 
   \hline
\end{tabular}
\caption{Example of a result table: BC = Bhattacharyya Coefficient, W = wilcox test statistic and p = associated p-value} 
\label{LABEL}
\end{table}




\section{Discussion}

% This goes with former results (see Parins-Fukuchi in review.)

\subsection{Effect of Character Differences on topology}
One way to look at the $CD$ metric is as a inverse of character correlation (see Methods \ref{CD_description}): a high $CD$ approximates a low level of character correlation and vice versa.
When characters are correlated, one could expect the matrices to convey a really strong (but probably incorrect) phylogenetic signal (since every characters agrees with each other) and conversely, when characters are uncorrelated, one could expect them to convey a weaker phylogenetic signal with a high amount of homoplasies.
Intuitively this would lead to badly resolved trees in our scenarios where the $CD$ was high.

One first noteworthy point is that, on average, the matrices with the highest $CD$ where the ones that performed the best at recovering the ``normal'' topology which in turns confirms the intuition that discrete morphological characters should be independent in phylogenetics.
This is also true when the characters are more similar to each other (low $CD$) resulting in worth trees due to the software treating all these characters as correlated.
One second noteworthy point is that compared to simply randomising $CD$ in the matrices (effectively bootstrapping), maximising the $CD$ was, at least in small sized matrices, not more effective to recover the ``normal'' topology.
Since many matrices are in the range size \citep{guillerme2016assessment} it is actually encouraging that actively coding characters to have high $CD$ values will not significantly improve the quality of the matrix compared to actually randomly coding characters.
Coding characters with low $CD$ however will decrease the quality of the matrix.

\subsubsection{Effect of the number of characters}
As expected by the sheer design of this research project, the number of character has a nested effect on character correlation: increasing the number of characters in our simulation scenarios (i.e. ``maximised'', ``minimised'' and ``randomised'') effectively increased the amount of high/low $CD$ values per matrix.
This increase in character numbers thus increases the effect of $CD$ on tree topology with $CD$

\subsubsection{Effect of the number of taxa}
Same blabla (probably).

\subsection{Effect of Character Differences on the inference method}
The rather strong nested effect of the method for recovering can be due to the sheer difference in both methods.
These difference in the ability of both methods in recovering the ``right'' topology has been heavily discussed in the last five years with some indications that Bayesian inference will more readily recover the ``right'' topology when analysing discrete morphological alone (\citealt{wrightbayesian2014,OReilly20160081,puttick2017uncertain}; although some critics have been made in favour of parsimony: \citealt{spencerefficacy2013,goloboff2017weighted}).
In this study, it is possible that our simulation protocol for generating the characters (favouring slightly more M$k$-based characters rather than HKY ones) could slightly favour Bayesian inference over Parsimony, however, our protocol for selecting matrices \citep[i.e. those with in a $CI>0.26$ in a quick parsimony search;]{OReilly20160081} could also favour Parsimony analysis.
It was however not the purpose of this study to compare the overall performance of both methods but rather to measure the effect of character correlation on each of those methods separately.

That being said, it is interesting to analysis this difference in tree inference method in the light of the effect of high/low $CD$.
In fact the differences observed here could be due to the inherent mechanisms of each method.
When many characters are homoplasic (high $CD$) parsimony will cope with this information by generating longer trees (which will be more likely to be discarded in the tree search).
Conversely Bayesian can cope with homoplasy more easily by increasing some branch length to accommodate more changes and will also incorporate sub-optimal trees in the final results.

\subsection{Distinction between different character correlations}
Although both biological and evolutionary induce correlation are what most evolutionary biologists are genuinely interested in and that coding induced correlation is readily avoided through best practices, software induced character correlation would be the main source of character dependence in systematic biology.

As we mentioned in the introduction of this study, we identified three different major sources of character correlation (biological, evolutionary and coding induced correlation).
In practice, however, we argue that software induced character correlation would be the main source of character dependence in systematic biology (see Table \ref{Tab:example_matrix}).
Therefore, in this study, we mainly focused on this source of correlation between characters.
It is important to note, however, that because the characters were simulated using evolutionary models based on Birth-Death trees, evolutionary induced correlation is present in our simulation (though not analysed specifically).
Conversely, biological induced correlation would be more complex to simulate and are out of the scope of this analysis.

Additionally, the two types of correlations that most evolutionary biologists are genuinely interested in (biological and evolutionary) can only be studied \textit{a posteriori} using phylogenetic trees and should not be used as an \textit{a priori}.
In fact, the links between specific characters should studied explicitly through hypothesis testing based on an underlying phylogenetic framework - for example in evo-devo \citep[e.g.][]{goswami2006morphological} or in macroevolution \citep[e.g.][]{fitzjohn2014much} - and should thus be independent of the phylogenetic inference itself.


\subsection{Conclusion}
As we presented in the introduction, dependence between characters can be induced through three main phenomenon: the biological, evolutionary or coding induced correlation between characters.
Although one could argue (righteously!) that coding induced correlation is easily avoidable and that biological and evolutionary correlations are actually at the core of evolutionary biology, in the age of ever expanding morphological matrices \citep[e.g.][with more than 1000 characters each]{nithe2013,O'Leary08022013}, we can expect the dependence between characters to increase stochastically.
Moreover, because phylogenetic inference software are unable to \textit{a priori} differentiate these difference correlations, it is important to understand to what extant topologies can be induced by such bias.

We found that Character Differences as a proxy for character correlation is not a problem \textit{per se} as long as characters are not actively coded to be similar.
On the other hand, actively selecting characters based to favour independence does not highly increase the ability of recovering tree topology (compared to simply bootstrapping a matrix - at least for modest size matrices).
We hope that these results will encourage researchers working on discrete morphological characters to continue exploring morphology through discrete characters to better understand the Tree of Life.

\section{Data availability and repeatability}
The consensus trees are available on figshare at \url{@@@}.
The code for reproducing the simulation is available and explained at \url{https://github.com/TGuillerme/CharactersCorrelation}.
The vignette for reproducing the analysis and the figure is available at \url{http://htmlpreview.github.io/?https://github.com/TGuillerme/CharactersCorrelation/Analysis/EffectCorrelation.html}.

\section{Funding}
European Research Council under the European Union’s Seventh Framework Programme (FP/2007–2013)/ERC Grant Agreement number 311092.

\section{Acknowledgements}
Calculations where done using the Imperial College London Cluster Services (doi: 10.14469/hpc/2232).
We thank Alberto Pascual Garcia for input in the design of the simulations protocol and Guillermo Herraiz Yebes for helping with the CD metric proof.


% Suggested reviewers:
%- Liliana Davalos for MPE / Joe O'Reilly, April Wright 


\bibliographystyle{sysbio}
\bibliography{References}

\end{document}

