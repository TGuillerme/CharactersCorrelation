\documentclass[12pt,letterpaper]{article}
\usepackage{natbib}

%Packages
\usepackage{pdflscape}
\usepackage{fixltx2e}
\usepackage{textcomp}
\usepackage{fullpage}
\usepackage{float}
\usepackage{latexsym}
\usepackage{url}
\usepackage{epsfig}
\usepackage{graphicx}
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{bm}
\usepackage{array}
\usepackage[version=3]{mhchem}
\usepackage{ifthen}
\usepackage{caption}
\usepackage{hyperref}
\usepackage{amsthm}
\usepackage{amstext}
\usepackage{enumerate}
\usepackage[osf]{mathpazo}
\usepackage{dcolumn}
\usepackage{lineno}
\usepackage{dcolumn}
\usepackage{mathtools}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}%
\DeclarePairedDelimiter\norm{\lVert}{\rVert}%
\newcolumntype{d}[1]{D{.}{.}{#1}}

\pagenumbering{arabic}


%Pagination style and stuff
\linespread{2}
\raggedright
\setlength{\parindent}{0.5in}
\setcounter{secnumdepth}{0} 
\renewcommand{\section}[1]{%
\bigskip
\begin{center}
\begin{Large}
\normalfont\scshape #1
\medskip
\end{Large}
\end{center}}
\renewcommand{\subsection}[1]{%
\bigskip
\begin{center}
\begin{large}
\normalfont\itshape #1
\end{large}
\end{center}}
\renewcommand{\subsubsection}[1]{%
\vspace{2ex}
\noindent
\textit{#1.}---}
\renewcommand{\tableofcontents}{}
%\bibpunct{(}{)}{;}{a}{}{,}

%---------------------------------------------
%
%       START
%
%---------------------------------------------

\begin{document}

%Running head
\begin{flushright}
Version dated: \today
\end{flushright}
\bigskip
\noindent RH: Characters correlation

\bigskip
\medskip
\begin{center}

\noindent{\Large \bf Effect of coding correlated discrete character correlation on tree inference}
\bigskip

\noindent {\normalsize \sc Thomas Guillerme$^1$$^*$, and Martin D. Brazeau$^1$}\\
\noindent {\small \it 
$^1$Imperial College London, Silwood Park Campus, Department of Life Sciences, Buckhurst Road, Ascot SL5 7PY, United Kingdom.\\}
\end{center}
\medskip
\noindent{*\bf Corresponding author.} \textit{t.guillerme@imperial.ac.uk}\\ 
\vspace{1in}

%Line numbering
\modulolinenumbers[1]
\linenumbers

%---------------------------------------------
%
%       ABSTRACT
%
%---------------------------------------------

\newpage
\begin{abstract}
blablabla
\end{abstract}

\noindent (Keywords: )\\

\vspace{1.5in}

\newpage 


%---------------------------------------------
% LaTeX tips for modifying/editing the document:
%---------------------------------------------
% - You can comment using the percentage sign. I suggest you use the % sign alone for commenting out sections of the text:
%       e.g. "This is a really long sentence %because this sentence is very long." Here the % is used for ignoring the end of the sentence (but for some reason you want to keep track of it).%
%       For comments as in verbose comments, I suggest you use "%MB:":
%       e.g. "This is a really long sentence %because this sentence is very long. %MB: yeah, no shit!" 
% - For optimal version control, write only one sentence per line (for more precise track changes)
% - To build the pdf, use command+B in Sublime.
% - Because of the bibliography, the pdf needs to be build in the same folder that contains "References.bib" and "sysbio.bst"
% - For citing papers, you must put their bibtex reference in the "References.bib" file and then you can use the following sysbio tags:
%        \cite{bibtexBob2000} for citing within a sentence: "Bob (2000)"
%        \citep{bibtexBob2000} for citing within brackets: "(Bob, 2000)"
%        \citep[Before:][-After]{bibtexBob2000} for citing within brackets with additional text: "(Before: Bob, 2000 -After)"
%        \citealt{bibtexBob2000} for citing without brackets: "Bob, 2000"
%        You can put more cites in each \cite tag by separating them with commas.
% - For equation, find every details here: https://en.wikibooks.org/wiki/LaTeX/Mathematics
% - For titles and stuff, the hierarchy goes \section{}, \subsection{}, \subsubsection{} and so forth...
% - For bullet points or enumerations you can use:
%       \begin{itemize}
%           \item my first bullet point/enumeration
%       \end{itemize}
%       With replacing "itemize" by "enumerate" for enumeration.




%---------------------------------------------
%
%       INTRODUCTION
%
%---------------------------------------------
\section{Introduction}

The last five years have seen a drastic expansion (resurgence?) of the use of discrete morphological data in macroevolutionary studies.
In fact, traditionally confined to classic cladistics \citep{felsenstein2004inferring} these methods have recently been highly improved whether based on the models and methods for inferring phylogenies (\citealt{lewisa2001} + BAPSTinReview; with some debate on which method to use: \citealt{spencerefficacy2013,wrightbayesian2014,OReilly20160081}) or the methods to date them \citep[e.g.][]{bapsta2013} or to combine them with molecular data \citep{pyrondivergence2011,ronquista2012}.
In parallel, much development has also been done on pre-phylogenetic analysis \citep[e.g. data collection;][]{morphobank} as well as on post-phylogenetic analysis \citep[e.g. morphological disparity analysis;][]{Close2015,Claddis}.

However, using discrete morphological data comes with several caveats, like the effect of missing data \citep{Guillerme2016146} or of the model \citep{OReilly20160081}.
One specific assumption is that coded characters should not be correlated \citep{Brazeau2011}[FIND BETTER CITE?].

Character correlation can be due to
- co-evolution of two traits (e.g. the character ``number of digits on a limb'' co-evolves with the character ``presence/absence of limb'' - this correlation can be sometimes fairly obvious, sometimes less)
- modularity of morphological features [CITE GOSWAMI!]
- convergent evolution (e.g. the character ``flight'') [???]
- error from the coder (e.g. a coder can unintentionally code the same feature multiple times, thus effectively waiting it, for example: ``presence/absence of a proximal end on a limb'' and ``presence/absence of a distal end on a limb'' - effectively weighting the character ``presence/absence of a limb'' by two).
%-Don't code correlated characters but what is the actual effect of that? And how many characters are ``secretly'' correlated?

A lot of work has been done on character correlation \textit{per se}, but focussing mainly on how to measure correlation between characters to detect patterns of coevolution \citep{Lande1983,Maddison1990,Pagel1994,Pagel2006,Grabowski2016}.
However, only several attempts have been made on the actual effect of characters correlation on phylogenetic inference with two notable expections of \cite{Davalos01072014} on empirical data and \cite{ZouConvergence} on molecular data.
It is thus still unclear what will be the effect of characters correlation on phylogenetic inference.

% \cite{Davalos01072014}: character correlation + signal in bats
% \cite{Grabowski2016}: amount of data needed for testing correlations? CHECK
% \cite{Lande1983}: measure correlation CHECK
% \cite{Pagel1994}: measure correlation
% \cite{Pagel2006}: measure correlation Bayesian
% \cite{Maddison1990}: measure binary state character correlation for testing coevol
% \cite{ZouConvergence}: convergence measured as characters correlation (Removing convergence prone characters improves accuracy)

In this study, we propose a new way to measure character correlation (more adapted to discrete morphological characters) and test on simulated and empirical data what is the effect of character correlation on topology. %TG: check if we do just topology?
In other words, we generate matrices and maximise or minimise character correlation and see how that affects topology.


\section{Methods}

\subsection{Measuring correlation between characters}

We define characters as being correlated if they give the same phylogenetic information.
In order to measure, the difference between two characters, we propose a new distance metric defined as follows:

\subsubsection{Characters difference (CD)}
\begin{equation}
    CD_{(x,y)} = 1 - \left(\frac{\abs*{\frac{\abs*{\sum_{i}^{n}(x_{i} - y_{i})}}{n}-\frac{1}{2}}}{\frac{1}{2}}\right)
\end{equation}

\noindent Where $n$ is the number of taxa with comparable data and $x_i$ and $y_i$ are each characters states for the characters $x$ and $y$ and the taxa $i$ \citep[i.e. the Gower distance;][]{GowerDist}.
Since we are considering differences as being only Fitch-like, we ignore the actual distance between two different character states tokens: two same character states tokens have a difference of $0$ and two different, a difference of $1$ (e.g. $0 - 0 = 0$ or $1 - 8 = 1$).
In order to facilitate and standardise characters states comparison, we standardised each characters by arbitrarily modifying their character states tokens by order of appearance.
In other words, we replaced all the occurences of the first token to be $0$, the second to be $1$, etc.
This way, a character \texttt{A = {2,2,3,0,0,3}} would be standardised as \texttt{A' = {0,0,1,2,2,1}}. Note that in terms of phylogenetic signal, both \texttt{A} and \texttt{A'} are exactly identical (forming three distinct groups).
When the character difference is equal to $0$, it means that characters convey the same phylogenetic signal.
When the character difference is equal to 1 it means it conveys the most different signal.
For example with three characters \texttt{A = {0,1,1,1}}, \texttt{B = {1,0,0,0}} and \texttt{C = {0,1,2,3}}, $CD_{(A,B)} = 0$ and $CD_{(A,C)} = 1$.

This metric respects triangular equality [CHECK THE PROPER NAME] (i.e. $CD_{(A,B)} = CD_{(B,A)}$ and $CD_{(A,C)} = CD_{(B,C)}$).

\subsection{Simulating discrete morphological matrices}

To simulate the matrices we applied a protocol similar to \citep{Guillerme2016146}.
First, we generate random birth-death trees with the birth ($\lambda$) and death ($\mu$) parameters sampled from a uniform ($0$,$1$) distribution maintaining $\lambda$ $>$ $\mu$ using the diversitree \texttt{R} package \citep[v0.9-8;][]{fitzjohndiversitree2012} and saving the tree after reaching either 25, 75 or 150 taxa.
For each tree, we arbitrarily set the outgroup to be the first taxa (alphabetically) thus effectively rooting the trees on this taxa.
These trees are hereafter called the ``true'' trees.
We then simulated the characters using the either of the two following models:
\begin{itemize}
    \item The HKY-binary model \citep{OReilly20160081} which is an HKY model \citep{HKY85} with a random states frequency (sampled from a uniform distribution an scale to sum to one) and using a transition/transvertion rate of two \citep{douadycomparison2003} but where the purines (AG) were changed into state $0$ and the pyrimidines (CT) in state $1$.
    This model has the advantage of not favouring Bayesian inference \citep[since it doesn't use a M$k$ model;][]{OReilly20160081} but can only generate binary state characters.
    \item To generate more that two states characters, we used the M$k$ model \citep{lewisa2001}.
    We draw the number of character states with a probability of $0.85$ for two-state characters (binary) and $0.15$ for three state characters \citep{Guillerme2016146}.
    Assuming the same transition rate between character states might seem unrealistic and ignoring characters following, for example, a Dollo pattern, \cite{Wright01072016} have shown that an equal rate transition is still strictly majority in empirical data.
\end{itemize}

For each character, both models (HKY-binary or M$k$) where chosen randomly and ran with an overall evolutionary rate drawn from a gamma distribution ($\beta$ = $100$ and $\alpha$ = $3$).
We resimulated every invariant characters to obtain a matrix with no invariant characters.
Choosing these low evolutionary rate values allowed us to obtain discrete characters matrices with realistic values of Consistency Indices that where superior that $0.26$ \citep{OReilly20160081}.
For each trees with 25, 75 or 150 taxa we generated matrices with 100, 350 and 1000 characters following \cite{OReilly20160081}.
The matrices where generated using the \texttt{dispRity R} package \citep[][; \url{https://github.com/TGuillerme/dispRity}]{thomas_guillerme_2016_55646}.
To estimate the variance of our simulations and assess the effect of our random parameters, we repeated this step 50 times resulting in 450 morphological matrices (hereafter called the ``normal'' matrices).

\subsection{Modifying the matrices}

We then calculated the pairwise character differences for each generated matrices. 
We then modified the matrices to either maximise or minimise the pairwise character differences for each matrices using three different algorithms.
For maximising the pairwise differences between characters, we selected the characters that where the most similar to all the others (i.e. with an average character difference $<$$0.25$) and replaced them randomly by any of the remaining characters.
This operation increased the overall pairwise character difference in the matrix thus making the characters more dissimilar.
Conversely, for minimising the pairwise character differences, we selected the most dissimilar characters (i.e. with an average character difference $<$$0.75$) and randomly replaced them with the remaining ones.
Finally, because this operation effectively changes the weight of characters (i.e. giving the characters $<$$0.25$ or $>$$0.75$ a weight of $0$ and giving the randomly selected characters to replace them a weight of +$1$), we randomly replaced the average number of characters replaced in the character maximisation and minimisation by any other characters as a null expectation modification (i.e. randomly weighting characters).
This step resulted in a total of 1800 matrices (hereafter called the ``maximised'', ``minimised'' and ``random'' matrices).
The algorithms for the three modifications is available on GitHub@@@. %TG: "@@@" is my "to replace" sign.

\subsection{Inferring the phylogenies}

We inferred the topologies in both Bayesian and Parsimony using MrBayes and PAUP* respectively.
Bayesian settings.
PAUP ``settings''.

\subsection{Comparing the topologies}

We compared the topologies using the same approach as in \cite{Guillerme2016146}.

\subsection{Empirical morphological matrices}

We applied the same procedure described above (without the morphological matrices simulation) to 100 empirical matrices downloaded from TreeBASE (\url{http://treebase.org/}).
The 100 matrices where selected to be the most representative of empirical work with discrete morphological data: with randomly selected matrices with more than 100 each, published between 1985 and 2013 and covering 19 taxonomic classes within 6 phyla (Chordata, Arthropoda, Annelida, Angiosperm, Gymnosperm and Pteridophyta).
The full list of matrices is available in the supplementary materials @@@.

\section{Acknowledgements}
European Research Council under the European Union’s Seventh Framework Programme (FP/2007–2013)/ERC Grant Agreement number 311092.


\section{Results}


\section{Discussion}


\subsection{Conclusion}

% Suggested reviewers:
%- Liliana Davalos

\bibliographystyle{sysbio}
\bibliography{References}

\end{document}

