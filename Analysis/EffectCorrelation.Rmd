---
title: "Effect of character correlation"
author: "Thomas Guillerme"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_width: 12
    fig_height: 6
---

Effect of character correlation
===============


Loading the functions and the data
-----------------------------------

Getting the functions and the data

```{r, eval = TRUE, message = FALSE}
library(dispRity)
source("functions.R") ; load.functions(test = FALSE)
dyn.load("../Functions/char.diff.so")
load("../Data/NTS/matrix.nts.Rda")
source("../Data/load.data.R")
```

Results
-----------------------------------

Comparison to 'best' tree (RF normalised distance)

```{r, fig.width=12, fig.height=12}
op <- par(mfrow=c(3,1), mar = c(2, 4, 1, 2))
plot.results.single(t25_list, metric = 2, what = "best",
    legend = TRUE, NTS = TRUE, xlab = "", ylab = "RF for 25 taxa",
    axislab = FALSE)
plot.results.single(t75_list, metric = 2, what = "best", ylab = "RF for 75 taxa",
    xlab = "", axislab = FALSE, NTS = TRUE)
plot.results.single(t150_list, metric = 2, what = "best",
    ylab = "RF for 150 taxa", NTS = TRUE)
par(op)
```

Comparison to 'best' tree (Triplets normalised distance)

```{r, fig.width=12, fig.height=12}
op <- par(mfrow=c(3,1), mar = c(2, 4, 1, 2))
plot.results.single(t25_list, metric = 4, what = "best",
    legend = TRUE, NTS = TRUE, xlab = "", ylab = "Tr for 25 taxa",
    axislab = FALSE)
plot.results.single(t75_list, metric = 4, what = "best", ylab = "Tr for 75 taxa",
    xlab = "", axislab = FALSE, NTS = TRUE)
plot.results.single(t150_list, metric = 4, what = "best",
    ylab = "Tr for 150 taxa", NTS = TRUE)
par(op)
```


Comparison to 'null' tree (RF normalised distance)

```{r, fig.width=12, fig.height=12}
op <- par(mfrow=c(3,1), mar = c(2, 4, 1, 2))
plot.results.single(t25_list, metric = 2, what = "null",
    legend = TRUE, NTS = TRUE, xlab = "", ylab = "RF for 25 taxa",
    axislab = FALSE)
plot.results.single(t75_list, metric = 2, what = "null", ylab = "RF for 75 taxa",
    xlab = "", axislab = FALSE, NTS = TRUE)
plot.results.single(t150_list, metric = 2, what = "null",
    ylab = "RF for 150 taxa", NTS = TRUE)
par(op)
```

Comparison to 'null' tree (Triplets normalised distance)

```{r, fig.width=12, fig.height=12}
op <- par(mfrow=c(3,1), mar = c(2, 4, 1, 2))
plot.results.single(t25_list, metric = 4, what = "null",
    legend = TRUE, NTS = TRUE, xlab = "", ylab = "Tr for 25 taxa",
    axislab = FALSE)
plot.results.single(t75_list, metric = 4, what = "null", ylab = "Tr for 75 taxa",
    xlab = "", axislab = FALSE, NTS = TRUE)
plot.results.single(t150_list, metric = 4, what = "null",
    ylab = "Tr for 150 taxa", NTS = TRUE)
par(op)
```

Some stats
-----------------------------------

```{r}
## Getting the whole data
whole_data <- list("t25" = t25_list, "t75" = t75_list, "t150" = t150_list)

## getting the aov data
aov_data <- get.aov.data(whole_data, "RF", "norm", combined = TRUE)

## with lme4
library(lme4) ; library(lmerTest)

## NTS function of scenario (random = method + taxa + character)
model <- lmer(NTS ~ scenario + (1|method/taxa/character), data = aov_data$data)
anova(model)
difflsmeans(model, test.effs = "scenario")

## Plotting the residuals
normal_test <- shapiro.test(residuals(model))
hist(residuals(model),
    main = paste("Normal (W=", round(normal_test$statistic, digit = 2) ,
        "; p=", round(normal_test$p.value, digit = 2) ,")", sep = ""))

## Residuals vs predicted plot
plot(fitted(model), residuals(model))

## The residuals seem
```


```{r, fig.width=12, fig.height=6}
op <- par(mfrow=c(1,2))
## Plotting the residuals
normal_test <- shapiro.test(residuals(model))
hist(residuals(model),
    main = paste("non-normal (W=", round(normal_test$statistic, digit = 2) ,
        "; p=", round(normal_test$p.value, digit = 2) ,")", sep = ""))

## Residuals vs predicted plot
homo_test <- bartlett.test(NTS ~ scenario, data = aov_data$data)
plot(fitted(model), residuals(model),
    main = paste("heterodastic (Bartlett K^2=", round(homo_test$statistic, digit = 2) ,
        "; p=", round(homo_test$p.value, digit = 2) ,")", sep = ""))
par(op)
```

The results seem to be heterodastic


Supp
-----------------------------------



Plotting the results for 25 taxa

```{r, fig.width=12, fig.height=6}
## Comparisons to the best tree (RF)
plot.results.single(t25_list, metric = 2, what = "best",
    main = "comparison to 'best' tree (25 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the best tree (Triplets)
plot.results.single(t25_list, metric = 4, what = "best",
    main = "comparison to 'best' tree (25 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the null tree (RF)
plot.results.single(t25_list, metric = 2, what = "null",
    main = "comparison to 'null' tree (25 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the null tree (Triplets)
plot.results.single(t25_list, metric = 4, what = "null",
    main = "comparison to 'null' tree (25 taxa)", legend = TRUE, NTS = TRUE)
```

Plotting the results for 75 taxa

```{r, fig.width=12, fig.height=6}
## Comparisons to the best tree (RF)
plot.results.single(t75_list, metric = 2, what = "best",
    main = "comparison to 'best' tree (75 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the best tree (Triplets)
plot.results.single(t75_list, metric = 4, what = "best",
    main = "comparison to 'best' tree (75 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the null tree (RF)
plot.results.single(t75_list, metric = 2, what = "null",
    main = "comparison to 'null' tree (75 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the null tree (Triplets)
plot.results.single(t75_list, metric = 4, what = "null",
    main = "comparison to 'null' tree (75 taxa)", legend = TRUE, NTS = TRUE)
```

Plotting the results for 150 taxa

```{r, fig.width=12, fig.height=6}
## Comparisons to the best tree (RF)
plot.results.single(t150_list, metric = 2, what = "best",
    main = "comparison to 'best' tree (150 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the best tree (Triplets)
plot.results.single(t150_list, metric = 4, what = "best",
    main = "comparison to 'best' tree (150 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the null tree (RF)
plot.results.single(t150_list, metric = 2, what = "null",
    main = "comparison to 'null' tree (150 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the null tree (Triplets)
plot.results.single(t150_list, metric = 4, what = "null",
    main = "comparison to 'null' tree (150 taxa)", legend = TRUE, NTS = TRUE)
```



Checking the results for 25 taxa

```{r, fig.width=12, fig.height=6}
## Comparisons to the true tree (RF)
plot.results.single(t25_list, metric = 2, what = "true",
    main = "comparison to 'true' tree (25 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the true tree (Triplets)
plot.results.single(t25_list, metric = 4, what = "true",
    main = "comparison to 'true' tree (25 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Checking comparisons (RF)
plot.results.single(t25_list, metric = 2, what = "check",
    main = "Check comparison (25 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Checking comparisons (Triplets)
plot.results.single(t25_list, metric = 4, what = "check",
    main = "Check comparison (25 taxa)", legend = TRUE, NTS = TRUE)
```


Checking the results for 75 taxa

```{r, fig.width=12, fig.height=6}
## Comparisons to the true tree (RF)
plot.results.single(t75_list, metric = 2, what = "true",
    main = "comparison to 'true' tree (75 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the true tree (Triplets)
plot.results.single(t75_list, metric = 4, what = "true",
    main = "comparison to 'true' tree (75 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Checking comparisons (RF)
plot.results.single(t75_list, metric = 2, what = "check",
    main = "Check comparison (75 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Checking comparisons (Triplets)
plot.results.single(t75_list, metric = 4, what = "check",
    main = "Check comparison (75 taxa)", legend = TRUE, NTS = TRUE)
```


Checking the results for 150 taxa

```{r, fig.width=12, fig.height=6}
## Comparisons to the true tree (RF)
plot.results.single(t150_list, metric = 2, what = "true",
    main = "comparison to 'true' tree (150 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Comparisons to the true tree (Triplets)
plot.results.single(t150_list, metric = 4, what = "true",
    main = "comparison to 'true' tree (150 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Checking comparisons (RF)
plot.results.single(t150_list, metric = 2, what = "check",
    main = "Check comparison (150 taxa)", legend = TRUE, NTS = TRUE)
```

```{r, fig.width=12, fig.height=6}
## Checking comparisons (Triplets)
plot.results.single(t150_list, metric = 4, what = "check",
    main = "Check comparison (150 taxa)", legend = TRUE, NTS = TRUE)
```