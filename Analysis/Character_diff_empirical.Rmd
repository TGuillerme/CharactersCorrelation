---
title: "Characters differences in empirical matrices"
author: "Thomas Guillerme"
date: "`r Sys.Date()`"
output:
  html_document:
    fig_width: 12
    fig_height: 12
---

Before starting
===============

Loading the package
-----------------------------------

```{r, eval = FALSE}
## The latest version of devtools
if(!require(devtools)) install.packages("devtools")

## The latest version of dispRity 
install_github("TGuillerme/dispRity")

## The latest version of Claddis
install_github("graemetlloyd/Claddis")
```

Loading the functions
-----------------------------------


```{r}
library(Claddis) ; library(dispRity)
source("functions.R") ; load.functions(test = FALSE)

## Function for helping loading the matrices
find.non.numerics <- function(x) {
    options(warn = -1)
    if(is.na(as.numeric(x))) {
        return(TRUE)
    } else {
        return(FALSE)
    }
}

## Functions for helping the density plots
get.max.x <- function(density) {
    return(max(density$x))
}

get.max.y <- function(density) {
    return(max(density$y))
}

get.min.x <- function(density) {
    return(min(density$x))
}

get.min.y <- function(density) {
    return(min(density$y))
}
```

Characters differences in empirical matrices
===============

Loading the matrices
-----------------------------------

We are going to use 100 matrices from TreeBase.
The matrices are the ones from Guillerme & Cooper 2016 (MPE) with different matrices sizes and different focal groups.

```{r}
## Set up the matrices path
matrix_path = "../Data/100_Matrices"
files <- list.files(path = matrix_path, pattern = ".nex")

## Read the matrices
matrices <- list()
for(matrix in 1:length(files)) {
    matrices[[matrix]] <- ReadMorphNexus(paste(matrix_path, files[matrix], sep ="/"))$matrix
    matrices[[matrix]][apply(matrices[[matrix]], c(1,2), find.non.numerics)] <- "?"
}
```

Measuring the correlations distributions
-----------------------------------

We are using the character differences metric (see the other vignette for more details) for comparing how different characters information is.
A difference of 0 means the characters convey the same phylogenetic information and a difference of 1 means they convey the most different information (i.e. not the opposite).

```{r}
## Calculate the differences
differences <- lapply(matrices, cor.matrix, char.diff)

## Estimate the distributions densities
densities <- lapply(differences, density, na.rm = TRUE)
```

We can then plot the distributions of the differences as so:

```{r, fig.width=10, fig.height=10}
## Plot the the densities distribution
op <- par(bty = "n")
## Empty plot
plot(1,1, col = "white",
    xlim = c(min(unlist(lapply(densities, get.min.x))), max(unlist(lapply(densities, get.max.x)))),
    ylim = c(min(unlist(lapply(densities, get.min.y))), max(unlist(lapply(densities, get.max.y)))),
    main = "Observed characters differences in 100 matrices",
    xlab = "Character differences", ylab = "Density")
## Plotting the density curves
silent <- lapply(densities, lines, col = "grey")
## Plotting the cumulative density
lines(density(na.omit(unlist(differences))), col = "black")
## Adding the legend
legend("topleft", legend = c("Combined", "Individual"), lty = 1, col = c("black", "grey"))
par(op)
```
